services:
  qdrant:
    image: qdrant/qdrant:latest
    container_name: foxlight-qdrant
    restart: unless-stopped
    ports:
      - "${QDRANT_HTTP_PORT}:6333"
      - "${QDRANT_GRPC_PORT}:6334"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:6333/healthz"]
      interval: 20s
      timeout: 10s
      retries: 5

  memory-manager:
    build:
      context: ../..
      dockerfile: Dockerfile
    image: ${MEMORY_MANAGER_IMAGE}
    container_name: foxlight-memory-manager
    restart: unless-stopped
    depends_on:
      qdrant:
        condition: service_healthy
    ports:
      - "${MEMORY_MANAGER_PORT}:8000"
    environment:
      MEMORY_DB_PATH: /app/data/memory.db
      QDRANT_HOST: qdrant
      QDRANT_PORT: 6333
      OLLAMA_BASE_URL: ${OLLAMA_BASE_URL}
      MEMORY_LLM_MODEL: ${MEMORY_LLM_MODEL}
      MEMORY_EMBED_MODEL: ${MEMORY_EMBED_MODEL}
    volumes:
      - memory_manager_data:/app/data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/api/health"]
      interval: 20s
      timeout: 10s
      retries: 5

volumes:
  qdrant_data:
  memory_manager_data:
